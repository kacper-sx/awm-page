---
import { ImageGallery } from "@/components/features/image-gallery";
import Layout from "@/layouts/Layout.astro";
import type { GetImageResult } from "astro";
import { getImage } from "astro:assets";

const recordImages = import.meta.glob(
  "/src/assets/galeria/dzien-kobiet/*.{jpg,png,webp,avif}",
  { eager: true, import: "default" },
);

// Konwersja warto≈õci na tablicƒô ≈õcie≈ºek do obraz√≥w
const images: string[] = Object.values(recordImages) as string[];

const imagePromises = images.map(async (src) => {
  if (!src) {
    console.error("üö® B≈ÇƒÖd: src jest undefined!");
    return null;
  }

  try {
    return await getImage({
      src,
      quality: 90,
      widths: [400, 600, 800, 1200, 1600, 2000],
      format: "webp",
    });
  } catch (error) {
    console.error("üö® B≈ÇƒÖd w getImage():", error);
    return null;
  }
});

// Usuniƒôcie `null` warto≈õci
const imageProps: GetImageResult[] = (await Promise.all(imagePromises)).filter(
  (img): img is GetImageResult => img !== null,
);
---

<Layout
  title="Akademia Wychowania Muzycznego - Aktualno≈õci"
  description="Jeste≈õmy Akademia Wychowania Muzycznego - grupa uzdolnionych muzycznie student√≥w i studentek z AWF w Bia≈Çej Podlaskiej."
  canonical="https://awm-awf.pl/"
  keywords="Aktualno≈õci AWM"
>
  <div class="px-spaced lg:py-36 py-24">
    <div class="mx-auto prose-hr:border-muted-foreground">
      <header class="pt-4 lg:pb-24 pb-12">
        <h1 class="font-serif text-3xl lg:text-5xl">Dzie≈Ñ Kobiet 2025</h1>
      </header>
      <div class="grid grid-cols-2 gap-4 lg:gap-8 lg:grid-cols-3">
        <ImageGallery client:idle imageProps={imageProps} />
      </div>
    </div>
  </div>
</Layout>
